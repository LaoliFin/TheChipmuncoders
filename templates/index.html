<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chipmunk Choir Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

	<!--FONTS-->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Encode+Sans+Condensed:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

</head>
<body>
    <div class="main-container">
        <div class="left-panel">
            <textarea class="text-input" id="textInput" placeholder="Enter your text here..."required></textarea>
            <button class="generate-button all-buttons" >Generate</button>
        </div>
        <div class="right-panel">
            <div class="options-container">
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" name="option1" value="chipmunks"> Chipmunks
                    </label>
                    <label>
                        <input type="checkbox" name="option2" value="choir"> Choir
                    </label>
                </div>
				<div class="style-dropdown">
					<label for="tune-style">Tune Style:</label>
					<div class="select-wrapper">
						<select id="tune-style">
							<option value="jig">Jig</option>
							<option value="reel">Reel</option>
							<option value="slip jig">Slip Jig</option>
							<option value="hornpipe">Hornpipe</option>
							<option value="polka">Polka</option>
							<option value="slide">Slide</option>
							<option value="waltz">Waltz</option>
							<option value="barndance">Barndance</option>
							<option value="strathspey">Strathspey</option>
							<option value="three-two">Three-two</option>
							<option value="mazurka">Mazurka</option>
							<option value="march">March</option>
						</select>
					</div>
				</div>
            </div>
            <div class="output-container">
                <div class="image-placeholder">
                    <!-- Image will go here -->
					<div class="audio-wrapper" id="audio-wrapper" style="display:none;">
						<audio id="audio-player" controls></audio>
					</div>
                    <img src="../static/chip1.png" alt="zacasen_alvin2">
                </div>
            </div>
            <div class="controls-container">
                 <div class="controls">
                    <!--<button class="play-button all-buttons">Play</button>-->
                    <button class="download-button all-buttons">Download</button>
                    <button class="go-to-card-button all-buttons" onclick="window.location.href = '/card';">Go To Card</button>
                </div>
            </div>
        </div>
    </div>

    <script>
		document.querySelector('.generate-button').addEventListener('click', async () => {
			const text = document.querySelector('.text-input').value;
			const style = document.getElementById('tune-style').value;
		
			const response = await fetch('/generate', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ text: text, style: style })
			});
		
			if (response.ok) {
				const blob = await response.blob();
				const url = URL.createObjectURL(blob);
				
				const audio = document.getElementById('audio-player');
				const audioWrapper = document.getElementById('audio-wrapper');
				audio.src = url;
				audioWrapper.style.display = 'block';
				audio.load();
		
				document.querySelector('.download-button').setAttribute('href', url);
				document.querySelector('.download-button').setAttribute('download', 'generated_singing.wav');
			} else {
				alert('Failed to generate audio. Please try again.');
			}
		});
		
		document.querySelector('.play-button').addEventListener('click', () => {
			const audio = document.getElementById('audio-player');
			if (audio.src) {
				audio.play();
			}
		});

	</script>		
</body>
</html>